<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>預言家日報</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Serif TC', serif;
            background-image: url('https://www.transparenttextures.com/patterns/old-wall.png');
            background-color: #e8e2d5;
        }
        .newspaper-title {
            font-family: 'Noto Serif TC', serif;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .paper-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .paper-card:hover {
            transform: translateY(-10px) rotate(2deg);
            box-shadow: 10px 10px 20px rgba(0,0,0,0.3);
        }
        .pdf-thumbnail-wrapper {
            aspect-ratio: 3 / 4;
            overflow: hidden;
            pointer-events: none;
        }
        .pdf-thumbnail-wrapper iframe {
            transform-origin: top left;
            transform: scale(0.5);
            width: 200%;
            height: 200%;
        }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
        .modal-content { position: relative; margin: 2% auto; padding: 20px; width: 90%; height: 90%; max-width: 1200px; }
        .close-button { position: absolute; top: -15px; right: -15px; color: #aaa; font-size: 40px; font-weight: bold; background-color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; line-height: 0; cursor: pointer; transition: color 0.3s; }
        .close-button:hover, .close-button:focus { color: #f00; text-decoration: none; }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-8">
        <header class="text-center mb-12">
            <h1 class="text-6xl newspaper-title text-white">預言家日報</h1>
            <p class="text-xl text-gray-200 mt-2">— 巫師世界最受信賴的新聞來源 —</p>
        </header>

        <main>
            <div id="paper-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-10">
                <p id="loading-message" class="text-white text-center col-span-full">正在從斜角巷取得最新報紙... (此過程可能非常緩慢)</p>
            </div>
        </main>
    </div>

    <div id="pdfModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close-button">&times;</span>
            <iframe id="pdf-viewer" src="" width="100%" height="100%" frameborder="0"></iframe>
        </div>
    </div>

    <script>
        const googleSheetCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRsJlYOi36tMOxFsIyiOO5yHxmw4VAnOYe1HGt-7MxChyR7UxfcZWuyOi2r8QgBJycuwIiEp1EcCIyZ/pub?output=csv';

        const paperGrid = document.getElementById('paper-grid');
        const modal = document.getElementById('pdfModal');
        const pdfViewer = document.getElementById('pdf-viewer');
        const closeModal = document.getElementById('closeModal');

        function getFileIdFromUrl(url) {
            if (!url) return null;
            const match = url.match(/[-\w]{25,}/);
            return match ? match[0] : null;
        }

        async function loadPapers() {
            const proxyUrl = 'https://api.allorigins.win/raw?url=';
            const requestUrl = `${proxyUrl}${encodeURIComponent(googleSheetCsvUrl)}`;

            try {
                const response = await fetch(requestUrl, { cache: 'no-cache' });
                if (!response.ok) throw new Error(`無法取得試算表資料。請確認您已正確「發佈到網路」。`);
                
                const csvData = await response.text();
                paperGrid.innerHTML = '';

                const rows = csvData.trim().split(/\r?\n/).filter(row => row.trim() !== '');
                if (rows.length === 0) {
                     paperGrid.innerHTML = '<p class="text-white text-center col-span-full">試算表中沒有資料。</p>';
                     return;
                }

                rows.forEach((row, index) => {
                    const parts = row.split(',');
                    if (parts.length < 1) return;

                    const pdfUrl = parts[0] || '';
                    const title = parts[1] || `預言家日報 - 第 ${index + 1} 期`;
                    
                    const fileId = getFileIdFromUrl(pdfUrl);
                    if (!fileId) {
                        console.warn(`第 ${index + 1} 行無法解析出有效的 File ID: ${pdfUrl}`);
                        return;
                    }

                    const card = document.createElement('div');
                    card.className = 'paper-card bg-white p-4 rounded-lg shadow-lg border-4 border-gray-700';
                    
                    const embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;

                    card.innerHTML = `
                        <div class="pdf-thumbnail-wrapper w-full rounded mb-4 border bg-gray-200">
                           <iframe src="${embedUrl}" class="w-full h-full" frameborder="0" scrolling="no"></iframe>
                        </div>
                        <h3 class="text-center font-bold text-lg">${title}</h3>
                    `;
                    
                    card.style.cursor = 'pointer';
                    card.addEventListener('click', () => {
                        pdfViewer.src = embedUrl;
                        modal.style.display = 'block';
                    });

                    paperGrid.appendChild(card);
                });

            } catch (error) {
                console.error('載入報紙時發生錯誤:', error);
                paperGrid.innerHTML = `<p class="text-yellow-300 text-center col-span-full">${error.message}</p>`;
            }
        }

        loadPapers();

        closeModal.addEventListener('click', () => {
            modal.style.display = 'none';
            pdfViewer.src = ''; 
        });
        window.addEventListener('click', (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
                pdfViewer.src = '';
            }
        });

        // *** 新增：禁用右鍵選單和 F12 ***
        document.addEventListener('contextmenu', event => {
            event.preventDefault();
            // 您可以在這裡加入一個友善的提示訊息
            // alert("為了保護內容，本站已禁用右鍵選單。");
        });

        document.addEventListener('keydown', event => {
            // 禁用 F12
            if (event.key === 'F12' || event.keyCode === 123) {
                event.preventDefault();
            }
            // 禁用 Ctrl+Shift+I (Chrome/Edge/Firefox)
            if (event.ctrlKey && event.shiftKey && event.key === 'I') {
                event.preventDefault();
            }
            // 禁用 Ctrl+Shift+J (Chrome/Edge)
            if (event.ctrlKey && event.shiftKey && event.key === 'J') {
                event.preventDefault();
            }
            // 禁用 Ctrl+U (查看原始碼)
            if (event.ctrlKey && event.key === 'U') {
                event.preventDefault();
            }
        });

    </script>

</body>
</html>
